# reverse

A flexsible and powerful command line tool to convert database to codes.

## Installation

```shell
go install github.com/charlesbases/reverse@latest
```

## Usage

```shell
$ reverse
Generates a golang struct for the specified schema and table.

Usage:
  reverse [command]

Available Commands:
  completion  Generate the autocompletion script for the specified shell
  help        Help about any command
  init        Init reverse yaml
  mysql       MySQL driver
  postgres    PostgreSQL driver
  version     Print reverse version

Flags:
  -f, --file string   reverse file (default "./reverse.yaml")
  -h, --help          help for reverse

Use "reverse [command] --help" for more information about a command.
```

## Configuration File

```yaml
source:
  # mysql: username:password@tcp(127.0.0.1:3306)/dbname?charset=utf8mb4&parseTime=True&loc=Local&timeout=5s&readTimeout=5s&writeTimeout=5s
  # postgresql: postgres://username:password@127.0.0.1:5432/dbname?sslmode=disable&connect_timeout=5
  dsn: "username:password@tcp(127.0.0.1:3306)/dbname?charset=utf8mb4&parseTime=True&loc=Local&timeout=5s&readTimeout=5s&writeTimeout=5s"
  max_lifetime: 5s
  max_idle_conns: 10
  max_open_conns: 20
target:
  output_dir: ./tables
  # acronyms will be capitalized
  acronyms:
    - id
    - ip
    - uuid
  # tables included. priority is greater than exclude_tables
  include_tables:
    - ".*"
  # tables excluded
#  exclude_tables:
#    - ".*"
  # generate multiple files or one
  multiple_files: true
  template: |
    {{ $structName := CamelCase .Name }}
    // Code generated by reverse {{ Version }}. DO NOT EDIT.
    // date: {{ Date }}
    package {{ PackageName }}

    // {{ $structName }} {{ if .Comment }}{{ .Comment }}{{ else }}{{ .Name }}{{ end }}
    type {{ $structName }} struct {
        {{range $index, $column := .Columns -}}
        {{ CamelCase $column.Name }} {{ GoType $column.ColumnType }} `json:"{{ $column.Name }}" gorm:"column:{{ $column.Name }}{{ if $column.IsPrimaryKey }};primaryKey{{ end }}"` // {{ if $column.Comment }}{{ $column.Comment }}{{ else }}{{ $column.Name }}{{ end }}
        {{end -}}
    }

    // TableName {{ .Name }}
    func (t *{{ $structName }}) TableName() (string) {
      return "{{ .Name }}"
    }
```

## Example

```mysql
create table user
(
    `id`          bigint unsigned                 not null auto_increment,
    `username`    varchar(30)         default ''  not null comment '用户名',
    `password`    varchar(30)         default ''  not null comment '用户密码',
    `email`       varchar(100)        default ''  not null comment '邮箱',
    `nick`        varchar(50)         default ''  not null comment '昵称',
    `avatar`      varchar(1000)       default ''  not null comment '头像',
    `birthday`    int unsigned        default '0' not null comment '生日',
    `gender`      tinyint(3) unsigned default '0' not null comment '性别',
    `intro`       varchar(150)        default ''  not null comment '简介',
    `create_time` bigint unsigned     default '0'  not null comment '记录创建的时间',
    `update_time` bigint unsigned     default '0'  not null comment '资料修改的时间',
    primary key (`id`),
    key `idx_create_time` (`create_time`)
) ENGINE = InnoDB
  DEFAULT CHARSET = utf8mb4
  COLLATE = utf8mb4_general_ci COMMENT = '用户基本信息';
```

```go
// Code generated by reverse v1.0.0. DO NOT EDIT.
// date: 2025-07-14 05:43:12
package tables

// User 用户基本信息
type User struct {
	ID         int64  `json:"id" gorm:"column:id;primaryKey"`        // id
	Username   string `json:"username" gorm:"column:username"`       // 用户名
	Password   string `json:"password" gorm:"column:password"`       // 用户密码
	Email      string `json:"email" gorm:"column:email"`             // 邮箱
	Nick       string `json:"nick" gorm:"column:nick"`               // 昵称
	Avatar     string `json:"avatar" gorm:"column:avatar"`           // 头像
	Birthday   int    `json:"birthday" gorm:"column:birthday"`       // 生日
	Gender     int8   `json:"gender" gorm:"column:gender"`           // 性别
	Intro      string `json:"intro" gorm:"column:intro"`             // 简介
	CreateTime int64  `json:"create_time" gorm:"column:create_time"` // 记录创建的时间
	UpdateTime int64  `json:"update_time" gorm:"column:update_time"` // 资料修改的时间
}

// TableName user
func (t *User) TableName() string {
	return "user"
}
```



## Template Funcs

- **Date**: Current date in UTC. (eg: 2025-07-14 04:11:29)
- **Version**: Current reverse version.
- **PackageName**: The package name of the generated file. The default is the folder name of OutputDir.
- **CamelCase**: Name the columns in camel case.
- **GoType**: Convert sqltype to go type.

## Template Vars

- **Name**: Table name.
- **Comment**: Table comment.
- **Columns**: All columns in table.
  - **Name**: Column name.
  - **DataType**: Column data type.
  - **IsPrimaryKey**: Is this column a primary key?
  - **IsAutoIncrement**: Is this column incremented?
  - **IsNullable**: Is this column null?
  - **Default**: Column default value.
  - **Comment**: Column comment.
  - **Collation**: Column Collation.

